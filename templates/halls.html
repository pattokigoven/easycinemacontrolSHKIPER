<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ª–∞–º–∏ - Barco ICMP</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='halls.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>üé¨ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∏–Ω–æ–∑–∞–ª–∞–º–∏</h1>
                <div class="admin-info">
                    <span class="admin-name">üë§ {{ admin_name }}</span>
                    <button class="btn btn-logout" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>
                </div>
            </div>
            <div class="hall-selector">
                <label for="hall-select">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ª:</label>
                <select id="hall-select" class="hall-select" onchange="selectHall()">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ª --</option>
                    {% for hall in halls %}
                    <option value="{{ hall.id }}" data-ip="{{ hall.ip }}" data-port="{{ hall.port }}">{{ hall.name }} ({{ hall.ip }})</option>
                    {% endfor %}
                </select>
            </div>
        </header>

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–ª–∞ -->
        <div id="hall-container" class="hall-container" style="display: none;">
            <div class="hall-card" id="active-hall-card">
                <div class="hall-header">
                    <h2 id="active-hall-name">–ó–∞–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</h2>
                    <div class="hall-status">
                        <span class="status-indicator offline" id="status-indicator">‚óè</span>
                        <span class="status-text" id="status-text">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
                    </div>
                </div>



                <!-- –ù–æ–≤—ã–π –±–ª–æ–∫: –°—Ç–∞—Ç—É—Å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è -->
                <div class="control-section">
                    <h3>üéûÔ∏è –°—Ç–∞—Ç—É—Å —Å–µ–∞–Ω—Å–∞</h3>
                    <div id="playback-status" class="playback-status">
                        <div><strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> <span id="playback-state">‚Äî</span></div>
                        <div><strong>–¢–µ–∫—É—â–∏–π —Ç–∏—Ç—É–ª:</strong> <span id="playback-title">‚Äî</span></div>
                        <div><strong>–ü–æ–∑–∏—Ü–∏—è:</strong> <span id="playback-position">‚Äî</span> / <span id="playback-duration">‚Äî</span></div>
                    </div>
                </div>

                <div class="hall-controls">
                    <!-- –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ–∞–Ω—Å -->
                    <button class="btn btn-shutdown" id="shutdown-btn" 
                            onclick="shutdownSession()" disabled>
                        üõë –ó–ê–í–ï–†–®–ò–¢–¨ –°–ï–ê–ù–°
                    </button>

                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ CP750 –ê—É–¥–∏–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º -->
                    <div class="control-section cp750-section">
                        <h3>üéõÔ∏è CP750 –ê—É–¥–∏–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä</h3>
                        <div class="cp750-status" id="cp750-status">
                            <div class="cp750-info">
                                <span class="cp750-indicator offline" id="cp750-indicator">‚óè</span>
                                <span id="cp750-status-text">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</span>
                            </div>
                            <div class="cp750-details" id="cp750-details" style="display: none;">
                                <div class="cp750-detail"><strong>–§–æ—Ä–º–∞—Ç:</strong> <span id="cp750-format">‚Äî</span></div>
                                <div class="cp750-detail"><strong>–í—Ö–æ–¥:</strong> <span id="cp750-input">‚Äî</span></div>
                            </div>
                        </div>
                        <div class="cp750-controls">
                            <div class="cp750-fader-container">
                                <label>–ì—Ä–æ–º–∫–æ—Å—Ç—å CP750:</label>
                                <div class="cp750-fader-row">
                                    <button class="btn btn-cp750-mute" id="cp750-mute-btn" onclick="toggleCP750Mute()" disabled>
                                        üîä
                                    </button>
                                    <input type="range" class="cp750-fader" 
                                           id="cp750-fader" 
                                           min="0" max="100" value="50" step="1"
                                           oninput="updateCP750FaderDisplay(this.value)"
                                           onchange="setCP750Fader(this.value)"
                                           disabled>
                                    <span class="cp750-fader-value" id="cp750-fader-value">50</span>
                                </div>
                            </div>
                            <div class="cp750-presets">
                                <button class="btn btn-cp750" onclick="setCP750Preset(0)" disabled>0</button>
                                <button class="btn btn-cp750" onclick="setCP750Preset(40)" disabled>40</button>
                                <button class="btn btn-cp750" onclick="setCP750Preset(50)" disabled>50</button>
                                <button class="btn btn-cp750" onclick="setCP750Preset(60)" disabled>60</button>
                                <button class="btn btn-cp750" onclick="setCP750Preset(70)" disabled>70</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ú–∏–Ω–∏-–ª–æ–≥ -->
                <div class="hall-log" id="hall-log">
                    <div class="log-entry info">[--:--:--] –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ª...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div id="confirm-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
            <p id="modal-message">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ–∞–Ω—Å?</p>
            <div class="modal-details">
                <p>–ë—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:</p>
                <ul>
                    <li id="step-stop">‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</li>
                    <li id="step-dowser">üö™ –ó–∞–∫—Ä—ã—Ç–∏–µ —à—Ç–æ—Ä–∫–∏ (Dowser)</li>
                    <li id="step-lamp">üí° –í—ã–∫–ª—é—á–µ–Ω–∏–µ –ª–∞–º–ø—ã</li>
                    <li id="step-fader">üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å CP750 ‚Üí 30</li>
                    <li id="step-input">üîå –í—Ö–æ–¥ CP750 ‚Üí non_sync</li>
                </ul>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-danger" id="modal-confirm">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                <button class="btn btn-secondary" id="modal-cancel">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='halls.js') }}"></script>
</body>
</html>
